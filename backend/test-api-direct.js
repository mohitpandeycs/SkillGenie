// Direct API Test - Verify skill-specific content generation

async function testAPIDirect() {
  console.log('üîç DIRECT API TEST - Verifying Skill-Specific Content');
  console.log('='*60);
  
  const API_BASE = 'http://localhost:5000/api';
  const testCases = [
    { skill: 'Mobile Development', expected: 'Mobile' },
    { skill: 'Data Science', expected: 'Data' },
    { skill: 'Python', expected: 'Python' },
    { skill: 'React', expected: 'React' }
  ];
  
  for (const test of testCases) {
    console.log(`\nüß™ Testing: ${test.skill}`);
    console.log('-'*40);
    
    try {
      // Test Roadmap API
      console.log('1. Testing Roadmap API...');
      const roadmapResponse = await fetch(`${API_BASE}/roadmaps/generate/dynamic`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          skill: test.skill,
          level: 'beginner',
          duration: '3-6 months'
        })
      });
      
      const roadmapData = await roadmapResponse.json();
      
      if (roadmapData.success) {
        const title = roadmapData.data?.title || 'No title';
        const firstChapter = roadmapData.data?.chapters?.[0]?.title || 'No chapter';
        const containsExpected = title.includes(test.expected) || firstChapter.includes(test.expected);
        
        console.log(`  ${containsExpected ? '‚úÖ' : '‚ùå'} Title: "${title}"`);
        console.log(`  First Chapter: "${firstChapter}"`);
        console.log(`  Chapters Count: ${roadmapData.data?.chapters?.length || 0}`);
        console.log(`  Generated by: ${roadmapData.generatedBy || 'Unknown'}`);
        
        if (!containsExpected) {
          console.log(`  ‚ö†Ô∏è WARNING: Content doesn't match skill "${test.skill}"`);
        }
      } else {
        console.log('  ‚ùå Roadmap generation failed');
      }
      
      // Test Analytics API
      console.log('\n2. Testing Analytics API...');
      const analyticsResponse = await fetch(
        `${API_BASE}/analytics/market/dynamic?skill=${encodeURIComponent(test.skill)}&location=USA`
      );
      
      const analyticsData = await analyticsResponse.json();
      
      if (analyticsData.success) {
        const skill = analyticsData.data?.skill || 'No skill';
        const salary = analyticsData.data?.marketOverview?.averageSalary || 'No salary';
        const matchesSkill = skill === test.skill;
        
        console.log(`  ${matchesSkill ? '‚úÖ' : '‚ùå'} Skill: "${skill}"`);
        console.log(`  Average Salary: ${salary}`);
        console.log(`  Generated by: ${analyticsData.generatedBy || 'Unknown'}`);
        
        if (!matchesSkill) {
          console.log(`  ‚ö†Ô∏è WARNING: Analytics for wrong skill!`);
        }
      } else {
        console.log('  ‚ùå Analytics generation failed');
      }
      
    } catch (error) {
      console.log(`  ‚ùå Error: ${error.message}`);
    }
  }
  
  console.log('\n' + '='*60);
  console.log('üìä TEST SUMMARY:');
  console.log('Check results above - each skill should show unique content');
  console.log('If all show Python content, there\'s still a bug to fix');
  console.log('='*60);
}

// Run the test
testAPIDirect().catch(console.error);
