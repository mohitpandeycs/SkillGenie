// Final verification that skill-specific content is working

async function finalVerification() {
  console.log('üéØ FINAL VERIFICATION - SKILL-SPECIFIC CONTENT');
  console.log('='*60);
  
  const testCases = [
    {
      skill: 'Mobile Development',
      expectedInTitle: 'Mobile',
      expectedInChapter: 'mobile'
    },
    {
      skill: 'Data Science', 
      expectedInTitle: 'Data Science',
      expectedInChapter: 'python'
    },
    {
      skill: 'React',
      expectedInTitle: 'React',
      expectedInChapter: 'react'
    },
    {
      skill: 'Python',
      expectedInTitle: 'Python', 
      expectedInChapter: 'python'
    }
  ];
  
  let passedTests = 0;
  let totalTests = testCases.length;
  
  for (const test of testCases) {
    console.log(`\nüì± Testing: ${test.skill}`);
    console.log('-'*40);
    
    try {
      // Test Roadmap
      const roadmapResponse = await fetch('http://localhost:5000/api/roadmaps/generate/dynamic', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          skill: test.skill,
          level: 'beginner',
          duration: '3-6 months'
        })
      });
      
      const roadmapData = await roadmapResponse.json();
      
      if (roadmapData.success) {
        const title = roadmapData.data.title;
        const firstChapter = roadmapData.data.chapters?.[0]?.title || '';
        
        console.log(`üìö Title: "${title}"`);
        console.log(`üìñ First Chapter: "${firstChapter}"`);
        console.log(`üî¢ Total Chapters: ${roadmapData.data.chapters?.length}`);
        console.log(`ü§ñ Generated by: ${roadmapData.generatedBy}`);
        
        // Verify content is skill-specific
        const titleCorrect = title.includes(test.expectedInTitle);
        const chapterCorrect = firstChapter.toLowerCase().includes(test.expectedInChapter);
        
        if (titleCorrect || chapterCorrect) {
          console.log(`‚úÖ PASS: Content is specific to ${test.skill}`);
          passedTests++;
        } else {
          console.log(`‚ùå FAIL: Content is NOT specific to ${test.skill}`);
          console.log(`   Expected title to contain: "${test.expectedInTitle}"`);
          console.log(`   Expected chapter to contain: "${test.expectedInChapter}"`);
        }
        
        // Test Analytics
        const analyticsResponse = await fetch(
          `http://localhost:5000/api/analytics/market/dynamic?skill=${encodeURIComponent(test.skill)}&location=USA`
        );
        
        const analyticsData = await analyticsResponse.json();
        
        if (analyticsData.success) {
          const analyticsSkill = analyticsData.data.skill;
          console.log(`üìä Analytics Skill: "${analyticsSkill}"`);
          
          if (analyticsSkill === test.skill) {
            console.log(`‚úÖ Analytics match the requested skill`);
          } else {
            console.log(`‚ùå Analytics mismatch: requested "${test.skill}", got "${analyticsSkill}"`);
          }
        }
        
      } else {
        console.log(`‚ùå FAIL: Roadmap generation failed for ${test.skill}`);
      }
      
    } catch (error) {
      console.log(`‚ùå ERROR: ${error.message}`);
    }
  }
  
  console.log('\n' + '='*60);
  console.log('üìä FINAL RESULTS:');
  console.log(`‚úÖ Passed: ${passedTests}/${totalTests} tests`);
  console.log(`‚ùå Failed: ${totalTests - passedTests}/${totalTests} tests`);
  
  if (passedTests === totalTests) {
    console.log('üéâ ALL TESTS PASSED! System is generating skill-specific content!');
  } else {
    console.log('‚ö†Ô∏è SOME TESTS FAILED! System may still be showing generic content.');
  }
  
  console.log('\nüåü INSTRUCTIONS FOR USER:');
  console.log('1. Go to http://localhost:3000/dynamic-roadmap');
  console.log('2. Select "Mobile Development" and generate roadmap');
  console.log('3. You should see Mobile-specific chapters (iOS, Android, etc.)');
  console.log('4. Then select "Data Science" and generate roadmap');
  console.log('5. You should see Data Science-specific chapters (Python, ML, etc.)');
  console.log('6. Each skill should show DIFFERENT content!');
  console.log('='*60);
}

finalVerification().catch(console.error);
