// Test the new Gemini AI Analyst architecture

const improvedGeminiService = require('./services/improvedGeminiService');

async function testGeminiAnalyst() {
  console.log('🤖 TESTING GEMINI AS AI ANALYST');
  console.log('='*50);
  
  // Simulate user profile from questionnaire
  const userProfile = {
    education: 'undergraduate',
    experience: 'some_experience',
    currentSkills: ['Programming', 'Problem Solving'],
    interests: ['Technology', 'Mobile Development'],
    learningStyle: 'practical',
    careerGoals: 'Become a mobile app developer',
    preferredDomains: ['mobile_dev']
  };
  
  console.log('👤 User Profile:', userProfile);
  console.log('\n📊 Testing Analytics Generation...');
  
  try {
    const result = await improvedGeminiService.generateAnalytics('Mobile Development', 'India', userProfile);
    
    if (result.success) {
      console.log('\n✅ ANALYTICS GENERATED SUCCESSFULLY!');
      console.log('Generated by:', result.generatedBy);
      console.log('\n📈 Market Overview:');
      console.log('- Skill:', result.data.skill);
      console.log('- Location:', result.data.location);
      console.log('- Average Salary:', result.data.marketOverview?.averageSalary);
      console.log('- Growth Rate:', result.data.marketOverview?.growthRate);
      console.log('- Job Openings:', result.data.marketOverview?.jobOpenings);
      console.log('- Demand Level:', result.data.marketOverview?.demandLevel);
      
      console.log('\n🏢 Top Companies:');
      result.data.topCompanies?.slice(0, 3).forEach((company, index) => {
        console.log(`${index + 1}. ${company.name} - ${company.openings} openings`);
      });
      
      console.log('\n📊 Key Insights:');
      console.log('- Competition Level:', result.data.marketOverview?.competitionLevel);
      console.log('- Future Outlook:', result.data.futureOutlook?.projection);
      console.log('- Automation Risk:', result.data.futureOutlook?.automationRisk);
      
      // Test if data is different for different skills
      console.log('\n🔄 Testing Data Variation...');
      const dataScience = await improvedGeminiService.generateAnalytics('Data Science', 'India', userProfile);
      
      if (dataScience.success) {
        console.log('\n📊 Data Science vs Mobile Development:');
        console.log(`Mobile Dev Salary: ${result.data.marketOverview?.averageSalary}`);
        console.log(`Data Science Salary: ${dataScience.data.marketOverview?.averageSalary}`);
        console.log(`Mobile Dev Growth: ${result.data.marketOverview?.growthRate}`);
        console.log(`Data Science Growth: ${dataScience.data.marketOverview?.growthRate}`);
        
        const isDifferent = result.data.marketOverview?.averageSalary !== dataScience.data.marketOverview?.averageSalary;
        console.log(`\n${isDifferent ? '✅ SUCCESS' : '❌ ISSUE'}: Data is ${isDifferent ? 'different' : 'same'} for different skills`);
      }
      
    } else {
      console.log('❌ Analytics generation failed');
    }
    
  } catch (error) {
    console.error('❌ Error:', error.message);
  }
  
  console.log('\n' + '='*50);
  console.log('🎯 GEMINI ANALYST ARCHITECTURE:');
  console.log('1. ✅ Collects real market data from multiple sources');
  console.log('2. ✅ Passes structured data + user profile to Gemini');
  console.log('3. ✅ Gemini acts as AI analyst to interpret data');
  console.log('4. ✅ Returns structured insights for frontend');
  console.log('5. ✅ Different data for different skills/locations');
}

testGeminiAnalyst().catch(console.error);
