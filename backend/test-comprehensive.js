const dynamicRoadmapService = require('./services/dynamicRoadmapService');
const aiMentorService = require('./services/aiMentorService');

async function testComprehensiveSystem() {
  console.log('üöÄ COMPREHENSIVE SKILLGENIE AI SYSTEM TEST');
  console.log('='*60);
  
  const skills = ['Mobile Development', 'Data Science', 'Web Development', 'Python', 'JavaScript'];
  
  for (const skill of skills) {
    console.log(`\nüì± TESTING: ${skill.toUpperCase()}`);
    console.log('-'*40);
    
    try {
      // Test 1: Generate Dynamic Roadmap
      console.log('1. Generating roadmap...');
      const roadmap = await dynamicRoadmapService.generateRoadmap(skill, 'beginner', '3-6 months');
      
      if (roadmap.success && roadmap.data) {
        console.log(`‚úÖ Roadmap: "${roadmap.data.title}"`);
        console.log(`   Chapters: ${roadmap.data.chapters?.length || 0}`);
        console.log(`   Generated by: ${roadmap.generatedBy}`);
        console.log(`   First chapter: ${roadmap.data.chapters?.[0]?.title || 'N/A'}`);
        
        // Test 2: Generate Quiz for first chapter
        if (roadmap.data.chapters?.[0]) {
          console.log('2. Generating quiz...');
          const quiz = await aiMentorService.generateQuiz(roadmap.data.chapters[0], 'medium', 5);
          
          if (quiz.success) {
            console.log(`‚úÖ Quiz: ${quiz.quiz.totalQuestions} questions`);
            console.log(`   Title: ${quiz.quiz.title}`);
          } else {
            console.log('‚ùå Quiz generation failed');
          }
        }
        
        // Test 3: AI Mentor Chat
        console.log('3. Testing AI mentor...');
        const chatResponse = await aiMentorService.chatMentor(
          `I'm learning ${skill} and feeling stuck. Can you help?`,
          {
            skill: skill,
            currentChapter: roadmap.data.chapters?.[0]?.title,
            quizScore: 75,
            roadmapProgress: 20
          }
        );
        
        if (chatResponse.success) {
          console.log(`‚úÖ AI Mentor: "${chatResponse.message.substring(0, 100)}..."`);
        } else {
          console.log('‚ùå AI Mentor failed');
        }
        
        // Test 4: Analytics
        console.log('4. Generating analytics...');
        const analytics = await dynamicRoadmapService.generateAnalytics(skill, 'USA');
        
        if (analytics.success && analytics.data) {
          console.log(`‚úÖ Analytics: ${analytics.data.marketOverview?.demandLevel} demand`);
          console.log(`   Salary: ${analytics.data.marketOverview?.averageSalary}`);
          console.log(`   Generated by: ${analytics.generatedBy || 'Fallback'}`);
        } else {
          console.log('‚ùå Analytics failed');
        }
        
      } else {
        console.log('‚ùå Roadmap generation failed');
      }
      
    } catch (error) {
      console.log(`‚ùå Error testing ${skill}:`, error.message);
    }
    
    console.log('-'*40);
  }
  
  console.log('\nüéâ COMPREHENSIVE TEST COMPLETE!');
  console.log('='*60);
  
  // Test API endpoints
  console.log('\nüåê TESTING API ENDPOINTS...');
  
  try {
    const testEndpoint = async (url, method = 'GET', body = null) => {
      const options = {
        method,
        headers: { 'Content-Type': 'application/json' }
      };
      
      if (body) {
        options.body = JSON.stringify(body);
      }
      
      const response = await fetch(`http://localhost:5000${url}`, options);
      const data = await response.json();
      
      console.log(`${response.ok ? '‚úÖ' : '‚ùå'} ${method} ${url}: ${response.status}`);
      
      return { response, data };
    };
    
    // Test health endpoint
    await testEndpoint('/api/health');
    
    // Test roadmap generation
    await testEndpoint('/api/roadmaps/generate/dynamic', 'POST', {
      skill: 'React',
      level: 'intermediate',
      duration: '2-3 months'
    });
    
    // Test AI mentor chat
    await testEndpoint('/api/ai-mentor/chat', 'POST', {
      message: 'How do I learn React effectively?',
      context: { skill: 'React', level: 'beginner' }
    });
    
    // Test analytics
    await testEndpoint('/api/analytics/market/dynamic?skill=React&location=USA');
    
  } catch (error) {
    console.log('‚ùå API endpoint test failed:', error.message);
  }
  
  console.log('\n‚ú® ALL TESTS COMPLETED!');
}

// Run if called directly
if (require.main === module) {
  testComprehensiveSystem().catch(console.error);
}

module.exports = testComprehensiveSystem;
