<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillGenie API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #45a049;
        }
        .result {
            background: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { border-color: #4CAF50; }
        .error { border-color: #f44336; }
        h1 { color: #4CAF50; }
        h2 { color: #2196F3; }
        .skill-button {
            background: #2196F3;
        }
        .skill-button:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <h1>üöÄ SkillGenie API Direct Test</h1>
    <p>Test if the backend is returning skill-specific content</p>

    <div class="test-section">
        <h2>1. Test Roadmap Generation</h2>
        <p>Click each skill to generate its roadmap:</p>
        <button class="skill-button" onclick="testRoadmap('Mobile Development')">Mobile Development</button>
        <button class="skill-button" onclick="testRoadmap('Data Science')">Data Science</button>
        <button class="skill-button" onclick="testRoadmap('Python')">Python</button>
        <button class="skill-button" onclick="testRoadmap('React')">React</button>
        <button class="skill-button" onclick="testRoadmap('JavaScript')">JavaScript</button>
        <div id="roadmap-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. Test Analytics Generation</h2>
        <p>Click each skill to get its analytics:</p>
        <button class="skill-button" onclick="testAnalytics('Mobile Development')">Mobile Development</button>
        <button class="skill-button" onclick="testAnalytics('Data Science')">Data Science</button>
        <button class="skill-button" onclick="testAnalytics('Python')">Python</button>
        <button class="skill-button" onclick="testAnalytics('React')">React</button>
        <div id="analytics-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. Summary</h2>
        <div id="summary" class="result">
            Waiting for tests...
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let testResults = [];

        async function testRoadmap(skill) {
            const resultDiv = document.getElementById('roadmap-result');
            resultDiv.innerHTML = `üîÑ Generating roadmap for "${skill}"...`;
            
            try {
                const response = await fetch(`${API_BASE}/roadmaps/generate/dynamic`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        skill: skill,
                        level: 'beginner',
                        duration: '3-6 months'
                    })
                });

                const data = await response.json();
                
                if (data.success && data.data) {
                    const roadmap = data.data;
                    const isCorrect = roadmap.title.includes(skill) || 
                                      roadmap.chapters?.[0]?.title.toLowerCase().includes(skill.toLowerCase());
                    
                    const result = `
${isCorrect ? '‚úÖ' : '‚ùå'} Skill: ${skill}
üìö Title: "${roadmap.title}"
üìñ First Chapter: "${roadmap.chapters?.[0]?.title || 'No chapters'}"
üìñ Second Chapter: "${roadmap.chapters?.[1]?.title || 'No second chapter'}"
üí∞ Salary: ${roadmap.estimatedSalaryRange}
üî¢ Total Chapters: ${roadmap.chapters?.length || 0}
ü§ñ Generated by: ${data.generatedBy || 'Unknown'}
${!isCorrect ? '‚ö†Ô∏è WARNING: Content doesn\'t match the requested skill!' : ''}
                    `;
                    
                    resultDiv.innerHTML = result;
                    resultDiv.className = `result ${isCorrect ? 'success' : 'error'}`;
                    
                    testResults.push({
                        skill,
                        type: 'roadmap',
                        correct: isCorrect,
                        title: roadmap.title
                    });
                    
                    updateSummary();
                } else {
                    resultDiv.innerHTML = `‚ùå Failed to generate roadmap for ${skill}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function testAnalytics(skill) {
            const resultDiv = document.getElementById('analytics-result');
            resultDiv.innerHTML = `üîÑ Fetching analytics for "${skill}"...`;
            
            try {
                const response = await fetch(`${API_BASE}/analytics/market/dynamic?skill=${encodeURIComponent(skill)}&location=USA`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    const analytics = data.data;
                    const isCorrect = analytics.skill === skill;
                    
                    const result = `
${isCorrect ? '‚úÖ' : '‚ùå'} Requested: ${skill}
üìä Returned: "${analytics.skill}"
üìç Location: ${analytics.location}
üíµ Average Salary: ${analytics.marketOverview?.averageSalary}
üìà Demand Level: ${analytics.marketOverview?.demandLevel}
üè¢ Job Openings: ${analytics.marketOverview?.jobOpenings}
ü§ñ Generated by: ${data.generatedBy || 'Unknown'}
${!isCorrect ? '‚ö†Ô∏è WARNING: Analytics for wrong skill!' : ''}
                    `;
                    
                    resultDiv.innerHTML = result;
                    resultDiv.className = `result ${isCorrect ? 'success' : 'error'}`;
                    
                    testResults.push({
                        skill,
                        type: 'analytics',
                        correct: isCorrect,
                        returned: analytics.skill
                    });
                    
                    updateSummary();
                } else {
                    resultDiv.innerHTML = `‚ùå Failed to fetch analytics for ${skill}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summary');
            const roadmapTests = testResults.filter(t => t.type === 'roadmap');
            const analyticsTests = testResults.filter(t => t.type === 'analytics');
            
            const roadmapCorrect = roadmapTests.filter(t => t.correct).length;
            const analyticsCorrect = analyticsTests.filter(t => t.correct).length;
            
            let summary = `üìä TEST RESULTS:\n\n`;
            summary += `ROADMAPS: ${roadmapCorrect}/${roadmapTests.length} correct\n`;
            summary += `ANALYTICS: ${analyticsCorrect}/${analyticsTests.length} correct\n\n`;
            
            if (roadmapTests.length > 0) {
                summary += `ROADMAP DETAILS:\n`;
                roadmapTests.forEach(test => {
                    summary += `  ${test.correct ? '‚úÖ' : '‚ùå'} ${test.skill}: "${test.title}"\n`;
                });
            }
            
            if (analyticsTests.length > 0) {
                summary += `\nANALYTICS DETAILS:\n`;
                analyticsTests.forEach(test => {
                    summary += `  ${test.correct ? '‚úÖ' : '‚ùå'} Requested: ${test.skill}, Got: ${test.returned}\n`;
                });
            }
            
            const allCorrect = roadmapCorrect === roadmapTests.length && 
                               analyticsCorrect === analyticsTests.length;
            
            if (testResults.length > 0) {
                summary += `\n${allCorrect ? 'üéâ ALL TESTS PASSED!' : '‚ö†Ô∏è SOME TESTS FAILED - System is showing wrong content'}`;
            }
            
            summaryDiv.innerHTML = summary;
            summaryDiv.className = `result ${allCorrect ? 'success' : 'error'}`;
        }
    </script>
</body>
</html>
